# -*- coding: utf-8 -*-
# ******************************************************************************
# Copyright (c) 2022. All rights reserved.
#
# This work is licensed under the Creative Commons Attribution 4.0 International License.
# To view a copy of this license, visit # http://creativecommons.org/licenses/by/4.0/.
#
# Author:      RoXimn <roximn@rixir.org>
# ******************************************************************************
from typing import Annotated, TypeAlias

from PySide6.QtCore import (QPointF, QRect)
from PySide6.QtGui import (QBrush, QColor, QImage, QLinearGradient, QPainter)

# ******************************************************************************
LUT = Annotated[tuple[int, ...], 256]
ColorTable: TypeAlias = tuple[tuple[int, int, int], ...]
GradientTable: TypeAlias = tuple[tuple[float, tuple[int, int, int]], ...]


# ******************************************************************************
_MAGMA_COLOR_TABLE: ColorTable = (
    (0, 0, 4),
    (1, 0, 5),
    (1, 1, 6),
    (1, 1, 8),
    (2, 1, 10),
    (2, 2, 12),
    (2, 2, 14),
    (3, 3, 16),
    (4, 3, 18),
    (4, 4, 20),
    (5, 4, 22),
    (6, 5, 24),
    (6, 5, 26),
    (7, 6, 28),
    (8, 7, 30),
    (9, 7, 32),
    (10, 8, 34),
    (11, 9, 36),
    (12, 9, 38),
    (13, 10, 41),
    (14, 11, 43),
    (16, 11, 45),
    (17, 12, 47),
    (18, 13, 50),
    (19, 13, 52),
    (20, 14, 54),
    (21, 14, 57),
    (23, 15, 59),
    (24, 15, 61),
    (25, 16, 64),
    (26, 16, 66),
    (28, 16, 68),
    (29, 17, 71),
    (30, 17, 73),
    (32, 17, 76),
    (33, 17, 78),
    (35, 18, 81),
    (36, 18, 83),
    (38, 18, 86),
    (39, 18, 88),
    (41, 17, 90),
    (42, 17, 93),
    (44, 17, 95),
    (46, 17, 97),
    (47, 17, 99),
    (49, 17, 101),
    (51, 16, 103),
    (52, 16, 105),
    (54, 16, 107),
    (56, 16, 109),
    (58, 15, 111),
    (59, 15, 112),
    (61, 15, 113),
    (63, 15, 115),
    (65, 15, 116),
    (66, 15, 117),
    (68, 15, 118),
    (70, 16, 119),
    (71, 16, 120),
    (73, 16, 121),
    (75, 17, 122),
    (76, 17, 122),
    (78, 17, 123),
    (79, 18, 124),
    (81, 18, 124),
    (83, 19, 125),
    (84, 19, 125),
    (86, 20, 126),
    (87, 21, 126),
    (89, 21, 126),
    (91, 22, 127),
    (92, 22, 127),
    (94, 23, 127),
    (95, 24, 128),
    (97, 24, 128),
    (98, 25, 128),
    (100, 26, 128),
    (101, 26, 129),
    (103, 27, 129),
    (105, 28, 129),
    (106, 28, 129),
    (108, 29, 129),
    (109, 30, 129),
    (111, 30, 130),
    (112, 31, 130),
    (114, 31, 130),
    (116, 32, 130),
    (117, 33, 130),
    (119, 33, 130),
    (120, 34, 130),
    (122, 34, 130),
    (123, 35, 130),
    (125, 36, 130),
    (127, 36, 130),
    (128, 37, 130),
    (130, 37, 130),
    (131, 38, 130),
    (133, 38, 130),
    (134, 39, 130),
    (136, 40, 130),
    (138, 40, 130),
    (139, 41, 130),
    (141, 41, 129),
    (142, 42, 129),
    (144, 42, 129),
    (146, 43, 129),
    (147, 43, 129),
    (149, 44, 129),
    (151, 44, 129),
    (152, 45, 128),
    (154, 46, 128),
    (155, 46, 128),
    (157, 47, 128),
    (159, 47, 127),
    (160, 48, 127),
    (162, 48, 127),
    (164, 49, 127),
    (165, 49, 126),
    (167, 50, 126),
    (169, 50, 126),
    (170, 51, 125),
    (172, 51, 125),
    (174, 52, 124),
    (175, 52, 124),
    (177, 53, 124),
    (178, 53, 123),
    (180, 54, 123),
    (182, 54, 122),
    (183, 55, 122),
    (185, 56, 121),
    (187, 56, 121),
    (188, 57, 120),
    (190, 57, 120),
    (192, 58, 119),
    (193, 59, 118),
    (195, 59, 118),
    (196, 60, 117),
    (198, 60, 117),
    (200, 61, 116),
    (201, 62, 115),
    (203, 63, 115),
    (204, 63, 114),
    (206, 64, 113),
    (208, 65, 112),
    (209, 66, 112),
    (211, 66, 111),
    (212, 67, 110),
    (214, 68, 109),
    (215, 69, 109),
    (217, 70, 108),
    (218, 71, 107),
    (220, 72, 106),
    (221, 73, 106),
    (222, 74, 105),
    (224, 75, 104),
    (225, 76, 103),
    (226, 77, 102),
    (228, 78, 102),
    (229, 79, 101),
    (230, 81, 100),
    (231, 82, 99),
    (233, 83, 99),
    (234, 84, 98),
    (235, 86, 97),
    (236, 87, 97),
    (237, 89, 96),
    (238, 90, 95),
    (239, 92, 95),
    (240, 93, 94),
    (241, 95, 94),
    (242, 97, 93),
    (242, 98, 93),
    (243, 100, 93),
    (244, 102, 93),
    (245, 104, 92),
    (245, 105, 92),
    (246, 107, 92),
    (247, 109, 92),
    (247, 111, 92),
    (248, 113, 92),
    (248, 114, 92),
    (249, 116, 92),
    (249, 118, 93),
    (250, 120, 93),
    (250, 122, 93),
    (250, 124, 94),
    (251, 126, 94),
    (251, 128, 95),
    (251, 129, 95),
    (252, 131, 96),
    (252, 133, 96),
    (252, 135, 97),
    (253, 137, 98),
    (253, 139, 99),
    (253, 141, 99),
    (253, 143, 100),
    (253, 145, 101),
    (254, 147, 102),
    (254, 149, 103),
    (254, 150, 104),
    (254, 152, 105),
    (254, 154, 106),
    (254, 156, 107),
    (255, 158, 108),
    (255, 160, 109),
    (255, 162, 111),
    (255, 164, 112),
    (255, 165, 113),
    (255, 167, 114),
    (255, 169, 115),
    (255, 171, 117),
    (255, 173, 118),
    (255, 175, 119),
    (255, 177, 121),
    (255, 179, 122),
    (255, 180, 124),
    (255, 182, 125),
    (255, 184, 126),
    (255, 186, 128),
    (255, 188, 129),
    (255, 190, 131),
    (255, 191, 132),
    (255, 193, 134),
    (255, 195, 135),
    (255, 197, 137),
    (255, 199, 139),
    (255, 201, 140),
    (255, 203, 142),
    (255, 204, 143),
    (255, 206, 145),
    (255, 208, 147),
    (255, 210, 148),
    (255, 212, 150),
    (255, 214, 152),
    (255, 215, 153),
    (255, 217, 155),
    (254, 219, 157),
    (254, 221, 159),
    (254, 223, 160),
    (254, 225, 162),
    (254, 226, 164),
    (254, 228, 166),
    (254, 230, 167),
    (254, 232, 169),
    (254, 234, 171),
    (254, 236, 173),
    (253, 237, 175),
    (253, 239, 177),
    (253, 241, 179),
    (253, 243, 180),
    (253, 245, 182),
    (253, 246, 184),
    (253, 248, 186),
    (253, 250, 188),
    (253, 252, 190),
    (253, 254, 192),
)

_VIRIDIS_COLOR_TABLE: ColorTable = (
    (68, 1, 84),
    (68, 2, 85),
    (69, 3, 87),
    (69, 5, 88),
    (69, 6, 90),
    (70, 8, 91),
    (70, 9, 93),
    (70, 11, 94),
    (70, 12, 96),
    (71, 14, 97),
    (71, 15, 98),
    (71, 17, 100),
    (71, 18, 101),
    (71, 20, 102),
    (72, 21, 104),
    (72, 22, 105),
    (72, 24, 106),
    (72, 25, 108),
    (72, 26, 109),
    (72, 28, 110),
    (72, 29, 111),
    (72, 30, 112),
    (72, 32, 113),
    (72, 33, 115),
    (72, 34, 116),
    (72, 36, 117),
    (72, 37, 118),
    (72, 38, 119),
    (72, 39, 120),
    (71, 41, 121),
    (71, 42, 121),
    (71, 43, 122),
    (71, 44, 123),
    (71, 46, 124),
    (70, 47, 125),
    (70, 48, 126),
    (70, 49, 126),
    (70, 51, 127),
    (69, 52, 128),
    (69, 53, 129),
    (69, 54, 129),
    (68, 56, 130),
    (68, 57, 131),
    (68, 58, 131),
    (67, 59, 132),
    (67, 60, 132),
    (67, 62, 133),
    (66, 63, 133),
    (66, 64, 134),
    (65, 65, 134),
    (65, 66, 135),
    (65, 67, 135),
    (64, 69, 136),
    (64, 70, 136),
    (63, 71, 136),
    (63, 72, 137),
    (62, 73, 137),
    (62, 74, 137),
    (61, 75, 138),
    (61, 77, 138),
    (60, 78, 138),
    (60, 79, 138),
    (59, 80, 139),
    (59, 81, 139),
    (58, 82, 139),
    (58, 83, 139),
    (57, 84, 140),
    (57, 85, 140),
    (56, 86, 140),
    (56, 87, 140),
    (55, 88, 140),
    (55, 89, 140),
    (54, 91, 141),
    (54, 92, 141),
    (53, 93, 141),
    (53, 94, 141),
    (52, 95, 141),
    (52, 96, 141),
    (51, 97, 141),
    (51, 98, 141),
    (51, 99, 141),
    (50, 100, 142),
    (50, 101, 142),
    (49, 102, 142),
    (49, 103, 142),
    (48, 104, 142),
    (48, 105, 142),
    (47, 106, 142),
    (47, 107, 142),
    (47, 108, 142),
    (46, 109, 142),
    (46, 110, 142),
    (45, 111, 142),
    (45, 112, 142),
    (45, 112, 142),
    (44, 113, 142),
    (44, 114, 142),
    (43, 115, 142),
    (43, 116, 142),
    (43, 117, 142),
    (42, 118, 142),
    (42, 119, 142),
    (41, 120, 142),
    (41, 121, 142),
    (41, 122, 142),
    (40, 123, 142),
    (40, 124, 142),
    (40, 125, 142),
    (39, 126, 142),
    (39, 127, 142),
    (38, 128, 142),
    (38, 129, 142),
    (38, 130, 142),
    (37, 131, 142),
    (37, 131, 142),
    (37, 132, 142),
    (36, 133, 142),
    (36, 134, 142),
    (35, 135, 142),
    (35, 136, 142),
    (35, 137, 142),
    (34, 138, 141),
    (34, 139, 141),
    (34, 140, 141),
    (33, 141, 141),
    (33, 142, 141),
    (33, 143, 141),
    (32, 144, 141),
    (32, 145, 140),
    (32, 146, 140),
    (32, 147, 140),
    (31, 147, 140),
    (31, 148, 140),
    (31, 149, 139),
    (31, 150, 139),
    (31, 151, 139),
    (30, 152, 139),
    (30, 153, 138),
    (30, 154, 138),
    (30, 155, 138),
    (30, 156, 137),
    (30, 157, 137),
    (30, 158, 137),
    (30, 159, 136),
    (30, 160, 136),
    (31, 161, 136),
    (31, 162, 135),
    (31, 163, 135),
    (31, 163, 134),
    (32, 164, 134),
    (32, 165, 134),
    (33, 166, 133),
    (33, 167, 133),
    (34, 168, 132),
    (35, 169, 131),
    (35, 170, 131),
    (36, 171, 130),
    (37, 172, 130),
    (38, 173, 129),
    (39, 174, 129),
    (40, 175, 128),
    (41, 175, 127),
    (42, 176, 127),
    (43, 177, 126),
    (44, 178, 125),
    (46, 179, 124),
    (47, 180, 124),
    (48, 181, 123),
    (50, 182, 122),
    (51, 183, 121),
    (53, 183, 121),
    (54, 184, 120),
    (56, 185, 119),
    (57, 186, 118),
    (59, 187, 117),
    (61, 188, 116),
    (62, 189, 115),
    (64, 190, 114),
    (66, 190, 113),
    (68, 191, 112),
    (70, 192, 111),
    (72, 193, 110),
    (73, 194, 109),
    (75, 194, 108),
    (77, 195, 107),
    (79, 196, 106),
    (81, 197, 105),
    (83, 198, 104),
    (85, 198, 102),
    (88, 199, 101),
    (90, 200, 100),
    (92, 201, 99),
    (94, 201, 98),
    (96, 202, 96),
    (98, 203, 95),
    (101, 204, 94),
    (103, 204, 92),
    (105, 205, 91),
    (108, 206, 90),
    (110, 206, 88),
    (112, 207, 87),
    (115, 208, 85),
    (117, 208, 84),
    (119, 209, 82),
    (122, 210, 81),
    (124, 210, 79),
    (127, 211, 78),
    (129, 212, 76),
    (132, 212, 75),
    (134, 213, 73),
    (137, 213, 72),
    (139, 214, 70),
    (142, 215, 68),
    (144, 215, 67),
    (147, 216, 65),
    (149, 216, 63),
    (152, 217, 62),
    (155, 217, 60),
    (157, 218, 58),
    (160, 218, 57),
    (163, 219, 55),
    (165, 219, 53),
    (168, 220, 51),
    (171, 220, 50),
    (173, 221, 48),
    (176, 221, 46),
    (179, 221, 45),
    (181, 222, 43),
    (184, 222, 41),
    (187, 223, 39),
    (189, 223, 38),
    (192, 223, 36),
    (195, 224, 35),
    (197, 224, 33),
    (200, 225, 32),
    (203, 225, 30),
    (205, 225, 29),
    (208, 226, 28),
    (211, 226, 27),
    (213, 226, 26),
    (216, 227, 25),
    (219, 227, 24),
    (221, 227, 24),
    (224, 228, 24),
    (226, 228, 24),
    (229, 228, 24),
    (232, 229, 25),
    (234, 229, 25),
    (237, 229, 26),
    (239, 230, 27),
    (242, 230, 28),
    (244, 230, 30),
    (247, 230, 31),
    (249, 231, 33),
    (251, 231, 35),
    (254, 231, 36)
)

_GRAYSCALE_GRADIENT: GradientTable = (
    (0.000,  (32,  32,  32)),
    (0.250,  (64,  64,  64)),
    (0.500,  (98,  96,  96)),
    (0.750, (144, 144, 144)),
    (0.875, (192, 192, 192)),
    (1.000, (208, 208, 208)),
)


# ******************************************************************************
def createColorMap(colortable: ColorTable,
                   reverse: bool = False) -> LUT:
    """Convert RGB color values to RGBA lookup table, with option to reverse"""
    lut = [QColor(r, g, b).rgba() for r, g, b in colortable]
    if reverse:
        lut.reverse()
    return tuple(lut)


# ******************************************************************************
def createGradientMap(gradient: GradientTable,
                      reverse: bool = False) -> LUT:
    """Convert RGB gradient values to RGBA lookup table, with option to reverse"""
    p1, p2 = QPointF(0, 0), QPointF(255, 0)
    if reverse:
        p1, p2 = p2, p1
    linearGradient = QLinearGradient(p1, p2)
    for stop, colors in gradient:
        linearGradient.setColorAt(stop, QColor(colors[0], colors[1], colors[2]))

    lut = QImage(256, 1, QImage.Format_ARGB32)
    painter = QPainter()
    painter.begin(lut)
    painter.fillRect(QRect(0, 0, 256, 1), QBrush(linearGradient))
    painter.end()
    return tuple(lut.pixelColor(n, 0).rgba() for n in range(256))


# ******************************************************************************
GRAYSCALE_LUT = createGradientMap(_GRAYSCALE_GRADIENT, reverse=False)
GRAYSCALE_LUT_R = createGradientMap(_GRAYSCALE_GRADIENT, reverse=True)
MAGMA_LUT = createColorMap(_MAGMA_COLOR_TABLE, reverse=False)
MAGMA_LUT_R = createColorMap(_MAGMA_COLOR_TABLE, reverse=True)
VIRIDIS_LUT = createColorMap(_VIRIDIS_COLOR_TABLE, reverse=False)
VIRIDIS_LUT_R = createColorMap(_VIRIDIS_COLOR_TABLE, reverse=True)

COLOR_MAPS_8BIT: dict[str, LUT] = {
    'magma': MAGMA_LUT,
    'magma_r': MAGMA_LUT_R,
    'viridis': VIRIDIS_LUT,
    'viridis_r': VIRIDIS_LUT_R,
    'grayscale': GRAYSCALE_LUT,
    'grayscale_r': GRAYSCALE_LUT_R,
}
"""
8bit RGBA colormaps

*   magma
*   viridis
*   grayscale

and their reverse maps.

:meta hide-value:
"""

# ******************************************************************************
